generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Pool {
  id                      String     @id @default(cuid())
  poolId                  Int        @map("pool_id")
  tokenMint               String     @map("token_mint")
  name                    String
  symbol                  String
  apr                     Float?
  apy                     Float?
  type                    String
  lockPeriod              Int?       @map("lock_period")
  totalStaked             Float      @default(0) @map("total_staked")
  rewards                 String?
  logo                    String?
  pairAddress             String?    @map("pair_address")
  hidden                  Boolean    @default(false)
  featured                Boolean    @default(false)
  views                   Int        @default(0)
  createdAt               DateTime   @default(now()) @map("created_at")
  hasSelfReflections      Boolean    @default(false) @map("has_self_reflections")
  hasExternalReflections  Boolean    @default(false) @map("has_external_reflections")
  externalReflectionMint  String?    @map("external_reflection_mint")
  reflectionTokenAccount  String?    @map("reflection_token_account")
  reflectionTokenSymbol   String?    @map("reflection_token_symbol")
  isInitialized           Boolean    @default(false) @map("is_initialized")
  poolAddress             String?    @map("pool_address")
  isPaused                Boolean    @default(false) @map("is_paused")
  isEmergencyUnlocked     Boolean    @default(false) @map("is_emergency_unlocked")
  platformFeePercent      Float      @default(2) @map("platform_fee_percent")
  flatSolFee              Float      @default(0.005) @map("flat_sol_fee")
  referralEnabled         Boolean    @default(false) @map("referral_enabled")
  referralWallet          String?    @map("referral_wallet")
  referralSplitPercent    Float?     @map("referral_split_percent")
  reflectionTokenDecimals Int?
  transferTaxBps          Int        @default(0) @map("transfer_tax_bps")
  reflectionVaultAddress  String?    @map("reflection_vault_address")
  isLPPool                Boolean?   @default(false)
  rewardTokenMint         String?
  rewardTokenSymbol       String?
  duration                Int?
  dexPoolAddress          String?
  dexType                 String?
  lockupSeconds           Int        @default(0) @map("lockup_seconds")
  poolDurationSeconds     Int        @default(0) @map("pool_duration_seconds")
  rateBpsPerYear          Int        @default(0) @map("rate_bps_per_year")
  rateMode                Int        @default(0) @map("rate_mode")
  featuredOrder           Int        @default(99) @map("featured_order")
  tokenDecimals           Int?       @map("token_decimals")
  Activity                Activity[]
  stakes                  Stake[]

  @@unique([tokenMint, poolId], name: "pool_token_pool_id_unique")
  @@index([tokenMint, poolId], map: "pool_token_pool_id_idx")
  @@index([tokenMint], map: "pool_token_mint_idx")
  @@index([transferTaxBps], map: "pool_transfer_tax_idx")
  @@map("pools")
}

model Stake {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  poolId    String   @map("pool_id")
  amount    Float
  createdAt DateTime @default(now()) @map("created_at")
  pool      Pool     @relation(fields: [poolId], references: [id], onDelete: Cascade)

  @@index([userId], map: "stake_user_id_idx")
  @@index([poolId], map: "stake_pool_id_idx")
  @@map("stakes")
}

model Activity {
  id        String   @id @default(cuid())
  type      String
  amount    Float
  timestamp DateTime @default(now())
  poolId    String   @map("pool_id")
  userId    String   @map("user_id")
  pool      Pool     @relation(fields: [poolId], references: [id], onDelete: Cascade)

  @@index([userId], map: "activity_user_id_idx")
  @@index([poolId], map: "activity_pool_id_idx")
  @@index([type], map: "activity_type_idx")
  @@map("activities")
}

model UserStake {
  id           String   @id @default(cuid())
  userWallet   String   @map("user_wallet")
  tokenMint    String   @map("token_mint")
  poolId       Int      @default(0) @map("pool_id")
  stakedAmount BigInt   @default(0) @map("staked_amount")
  stakePda     String   @unique @map("stake_pda")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@unique([userWallet, tokenMint, poolId])
  @@index([userWallet])
  @@index([tokenMint])
  @@index([stakedAmount])
  @@map("user_stakes")
}

model SEO {
  id                 String   @id @default(cuid())
  page               String   @unique
  title              String
  description        String
  keywords           String?
  ogTitle            String?  @map("og_title")
  ogDescription      String?  @map("og_description")
  ogImage            String?  @map("og_image")
  twitterCard        String?  @map("twitter_card")
  twitterTitle       String?  @map("twitter_title")
  twitterDescription String?  @map("twitter_description")
  twitterImage       String?  @map("twitter_image")
  canonicalUrl       String?  @map("canonical_url")
  updatedAt          DateTime @updatedAt @map("updated_at")
  createdAt          DateTime @default(now()) @map("created_at")

  @@map("seo")
}

model SwapConfig {
  id             Int      @id @default(autoincrement())
  platformFeeBps Int      @default(50)
  treasuryWallet String
  enabled        Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  maxSlippageBps Int      @default(100)
  featuredTokens String?
}

model SwapStats {
  id          String   @id @default(cuid())
  fromToken   String
  toToken     String
  fromAmount  Float
  toAmount    Float
  userAddress String
  volumeUsd   Float    @default(0)
  priceUsd    Float    @default(0)
  createdAt   DateTime @default(now())

  @@index([userAddress])
  @@index([createdAt])
  @@index([volumeUsd])
}

model LiquidityConfig {
  id             Int      @id @default(autoincrement())
  platformFeeBps Int      @default(50)
  treasuryWallet String
  enabled        Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model LiquidityPool {
  id          Int      @id @default(autoincrement())
  poolAddress String   @unique
  tokenA      String
  tokenB      String
  userAddress String
  lpTokens    Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userAddress])
  @@index([tokenA, tokenB])
}

model Lock {
  id            String   @id @default(cuid())
  lockId        BigInt   @map("lock_id")
  tokenMint     String   @map("token_mint")
  name          String
  symbol        String
  amount        Float
  lockDuration  Int      @map("lock_duration")
  unlockTime    DateTime @map("unlock_time")
  creatorWallet String   @map("creator_wallet")
  poolAddress   String?  @map("pool_address")
  stakePda      String?  @map("stake_pda")
  logo          String?
  isActive      Boolean  @default(true) @map("is_active")
  isUnlocked    Boolean  @default(false) @map("is_unlocked")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  poolId        Int?

  @@unique([tokenMint, lockId], name: "lock_token_lock_id_unique")
  @@index([tokenMint, lockId], map: "lock_token_lock_id_idx")
  @@index([creatorWallet], map: "lock_creator_wallet_idx")
  @@index([isActive], map: "lock_is_active_idx")
  @@map("locks")
}

model PopUpAd {
  id               String    @id @default(uuid())
  title            String
  description      String?
  imageUrl         String?   @map("image_url")
  ctaText          String?   @map("cta_text")
  ctaLink          String?   @map("cta_link")
  isActive         Boolean   @default(true) @map("is_active")
  startDate        DateTime? @map("start_date")
  endDate          DateTime? @map("end_date")
  displayFrequency String    @default("once_per_session") @map("display_frequency")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  contractAddress  String?   @map("contract_address")

  @@map("pop_up_ads")
}

model PlatformConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("platform_config")
}

model WhaleClubUser {
  walletAddress       String    @unique @map("wallet_address")
  twitterId           String?   @unique @map("twitter_id")
  twitterUsername     String?   @map("twitter_username")
  twitterAccessToken  String?   @map("twitter_access_token")
  twitterRefreshToken String?   @map("twitter_refresh_token")
  twitterTokenExpiry  DateTime? @map("twitter_token_expiry")
  totalPoints         Int       @default(0) @map("total_points")
  likesCount          Int       @default(0) @map("likes_count")
  retweetsCount       Int       @default(0) @map("retweets_count")
  quotesCount         Int       @default(0) @map("quotes_count")
  lastSyncedAt        DateTime? @map("last_synced_at")
  lastSyncedTweetId   String?   @map("last_synced_tweet_id")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  nickname            String?
  id                  String    @id @default(uuid())
  chatSessionToken    String?   @map("chat_session_token")
  chatSessionExpiry   DateTime? @map("chat_session_expiry")

  @@map("whale_club_users")
}

model WhaleClubMessage {
  id             String   @id @default(uuid())
  walletAddress  String   @map("wallet_address")
  nickname       String?
  message        String
  createdAt      DateTime @default(now()) @map("created_at")
  replyToId      String?  @map("reply_to_id")
  replyToPreview String?  @map("reply_to_preview")

  @@index([createdAt(sort: Desc)])
  @@map("whale_club_messages")
}

model VolumeBotTrade {
  id            String   @id @default(cuid())
  botId         String   @map("bot_id")
  walletAddress String?  @map("wallet_address")
  tradeType     String?  @map("trade_type")
  solAmount     Float?   @map("sol_amount")
  signature     String?
  status        String?
  errorMessage  String?  @map("error_message")
  createdAt     DateTime @default(now()) @map("created_at")

  @@map("volume_bot_trades")
}

model VolumeBotConfig {
  id                     String   @id @default(cuid())
  botId                  String   @unique @map("bot_id")
  isRunning              Boolean  @default(false) @map("is_running")
  tokenMint              String?  @map("token_mint")
  tokenSymbol            String?  @map("token_symbol")
  tokenDecimals          Int?     @map("token_decimals")
  minSolAmount           Float?   @map("min_sol_amount")
  maxSolAmount           Float?   @map("max_sol_amount")
  intervalSeconds        Int?     @map("interval_seconds")
  buyProbability         Float?   @map("buy_probability")
  slippageBps            Int?     @map("slippage_bps")
  createdAt              DateTime @default(now()) @map("created_at")
  updatedAt              DateTime @updatedAt @map("updated_at")
  botMode                String?  @default("split") @map("bot_mode")
  buyCount               Int?     @default(0) @map("buy_count")
  currentWalletIndex     Int?     @default(0) @map("current_wallet_index")
  customBuyAmount        Float?   @map("custom_buy_amount")
  customBuyTime          Int?     @map("custom_buy_time")
  customSellDelayMinutes Int?     @map("custom_sell_delay_minutes")
  cyclePhase             String?  @default("idle") @map("cycle_phase")

  @@map("volume_bot_config")
}

model VolumeBotWallet {
  id                  String   @id @default(cuid())
  botId               String   @map("bot_id")
  walletAddress       String   @map("wallet_address")
  privateKeyEncrypted String?  @map("private_key_encrypted")
  solBalance          Float?   @map("sol_balance")
  tokenBalance        Float?   @map("token_balance")
  createdAt           DateTime @default(now()) @map("created_at")

  @@unique([botId, walletAddress])
  @@map("volume_bot_wallets")
}

model HelpdeskAdmin {
  id                          String                    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email                       String                    @unique
  password_hash               String
  display_name                String
  avatar_url                  String?
  role                        String?                   @default("agent")
  is_active                   Boolean?                  @default(true)
  is_online                   Boolean?                  @default(false)
  failed_login_attempts       Int?                      @default(0)
  locked_until                DateTime?                 @db.Timestamptz(6)
  password_changed_at         DateTime?                 @default(now()) @db.Timestamptz(6)
  totp_secret                 String?
  totp_enabled                Boolean?                  @default(false)
  last_seen_at                DateTime?                 @db.Timestamptz(6)
  createdAt                   DateTime?                 @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                   DateTime?                 @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  sessions                    HelpdeskAdminSession[]
  helpdesk_audit_logs         helpdesk_audit_logs[]
  helpdesk_conversations      HelpdeskConversation[]
  helpdesk_messages           HelpdeskMessage[]
  helpdesk_push_subscriptions HelpdeskPushSubscription?

  @@index([email], map: "idx_helpdesk_admins_email")
  @@map("helpdesk_admins")
}

model HelpdeskAdminSession {
  id                 String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  adminId            String?        @map("admin_id") @db.Uuid
  token_hash         String         @unique
  refresh_token_hash String         @unique
  expiresAt          DateTime       @map("expires_at") @db.Timestamptz(6)
  refresh_expires_at DateTime       @db.Timestamptz(6)
  ip_address         String?
  user_agent         String?
  createdAt          DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  admin              HelpdeskAdmin? @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([adminId], map: "idx_helpdesk_sessions_admin")
  @@index([expiresAt], map: "idx_helpdesk_sessions_expires")
  @@index([refresh_token_hash], map: "idx_helpdesk_sessions_refresh")
  @@index([token_hash], map: "idx_helpdesk_sessions_token")
  @@map("helpdesk_admin_sessions")
}

model HelpdeskVisitor {
  id            String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  visitor_uuid  String                 @unique
  display_name  String?
  email         String?
  metadata      Json?                  @default("{}")
  page_url      String?
  user_agent    String?
  ip_hash       String?
  createdAt     DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  last_seen_at  DateTime?              @default(now()) @db.Timestamptz(6)
  conversations HelpdeskConversation[]

  @@index([visitor_uuid], map: "idx_helpdesk_visitors_uuid")
  @@map("helpdesk_visitors")
}

model HelpdeskConversation {
  id                String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  visitorId         String?           @map("visitor_id") @db.Uuid
  assigned_admin_id String?           @db.Uuid
  status            String?           @default("open")
  priority          String?           @default("normal")
  subject           String?
  unread_count      Int?              @default(0)
  last_message_at   DateTime?         @db.Timestamptz(6)
  createdAt         DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  helpdesk_admins   HelpdeskAdmin?    @relation(fields: [assigned_admin_id], references: [id], onUpdate: NoAction)
  visitor           HelpdeskVisitor?  @relation(fields: [visitorId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  messages          HelpdeskMessage[]

  @@index([assigned_admin_id], map: "idx_helpdesk_conversations_admin")
  @@index([status], map: "idx_helpdesk_conversations_status")
  @@index([visitorId], map: "idx_helpdesk_conversations_visitor")
  @@map("helpdesk_conversations")
}

model HelpdeskMessage {
  id                String                @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  conversationId    String?               @map("conversation_id") @db.Uuid
  sender_type       String
  admin_id          String?               @db.Uuid
  encrypted_content String
  iv                String
  auth_tag          String
  message_type      String?               @default("text")
  is_read           Boolean?              @default(false)
  createdAt         DateTime?             @default(now()) @map("created_at") @db.Timestamptz(6)
  helpdesk_admins   HelpdeskAdmin?        @relation(fields: [admin_id], references: [id], onUpdate: NoAction)
  conversation      HelpdeskConversation? @relation(fields: [conversationId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([conversationId], map: "idx_helpdesk_messages_conversation")
  @@index([createdAt(sort: Desc)], map: "idx_helpdesk_messages_created")
  @@map("helpdesk_messages")
}

model HelpdeskPushSubscription {
  id              String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  admin_id        String?        @unique @db.Uuid
  subscription    String
  endpoint        String
  createdAt       DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at      DateTime?      @default(now()) @db.Timestamptz(6)
  helpdesk_admins HelpdeskAdmin? @relation(fields: [admin_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([admin_id], map: "idx_helpdesk_push_admin")
  @@map("helpdesk_push_subscriptions")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model helpdesk_audit_logs {
  id              String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  action          String
  admin_id        String?        @db.Uuid
  target_id       String?        @db.Uuid
  target_type     String?
  metadata        Json?          @default("{}")
  ip_address      String?
  user_agent      String?
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  helpdesk_admins HelpdeskAdmin? @relation(fields: [admin_id], references: [id], onUpdate: NoAction)

  @@index([action], map: "idx_helpdesk_audit_action")
  @@index([admin_id], map: "idx_helpdesk_audit_admin")
  @@index([created_at(sort: Desc)], map: "idx_helpdesk_audit_created")
  @@index([ip_address], map: "idx_helpdesk_audit_ip")
}

model TelegramUser {
  id              String   @id @default(cuid())
  telegramId      String   @unique @map("telegram_id")
  username        String?
  firstName       String?  @map("first_name")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  wallets         TelegramWallet[]
  settings        TelegramUserSettings?
  snipes          SnipeOrder[]
  limitOrders     LimitOrder[]
  trades          TelegramTrade[]
  
  @@map("telegram_users")
}

model TelegramWallet {
  id                  String   @id @default(cuid())
  userId              String   @map("user_id")
  user                TelegramUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  name                String   @default("Main")
  walletAddress       String   @map("wallet_address")
  encryptedPrivateKey String   @map("encrypted_private_key")
  isDefault           Boolean  @default(false) @map("is_default")
  isManual            Boolean  @default(true) @map("is_manual")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  
  @@unique([userId, walletAddress])
  @@index([walletAddress])
  @@map("telegram_wallets")
}

model TelegramUserSettings {
  id              String   @id @default(cuid())
  userId          String   @unique @map("user_id")
  user            TelegramUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  slippageBps     Int      @default(1000) @map("slippage_bps")
  gasPrioritySol  Float    @default(0.005) @map("gas_priority_sol")
  priceImpactMax  Int      @default(40) @map("price_impact_max")
  confirmBuys     Boolean  @default(false) @map("confirm_buys")
  autoBuyEnabled  Boolean  @default(false) @map("auto_buy_enabled")
  autoBuyAmount   Float?   @map("auto_buy_amount")
  duplicateBuy    Boolean  @default(false) @map("duplicate_buy")
  useJito         Boolean  @default(false) @map("use_jito")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  @@map("telegram_user_settings")
}

model SnipeOrder {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  user            TelegramUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  tokenMint       String   @map("token_mint")
  tokenSymbol     String?  @map("token_symbol")
  amountSol       Float    @map("amount_sol")
  slippageBps     Int      @default(2500) @map("slippage_bps")
  gasPrioritySol  Float    @default(0.01) @map("gas_priority_sol")
  maxMarketCap    Float?   @map("max_market_cap")
  requireLpLock   Boolean  @default(false) @map("require_lp_lock")
  checkHoneypot   Boolean  @default(true) @map("check_honeypot")
  status          String   @default("pending")
  txSignature     String?  @map("tx_signature")
  errorMessage    String?  @map("error_message")
  expiresAt       DateTime? @map("expires_at")
  createdAt       DateTime @default(now()) @map("created_at")
  executedAt      DateTime? @map("executed_at")
  
  @@index([tokenMint, status])
  @@index([status])
  @@map("snipe_orders")
}

model LimitOrder {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  user            TelegramUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  tokenMint       String   @map("token_mint")
  tokenSymbol     String?  @map("token_symbol")
  orderType       String   @map("order_type")
  amountSol       Float?   @map("amount_sol")
  amountTokens    Float?   @map("amount_tokens")
  amountPercent   Float?   @map("amount_percent")
  triggerType     String   @default("price") @map("trigger_type")
  targetPriceUsd  Float?   @map("target_price_usd")
  targetMcUsd     Float?   @map("target_mc_usd")
  slippageBps     Int      @default(1000) @map("slippage_bps")
  status          String   @default("active")
  txSignature     String?  @map("tx_signature")
  expiresAt       DateTime? @map("expires_at")
  createdAt       DateTime @default(now()) @map("created_at")
  executedAt      DateTime? @map("executed_at")
  
  @@index([tokenMint, status])
  @@index([status])
  @@map("limit_orders")
}

model TelegramTrade {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  user            TelegramUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  walletAddress   String   @map("wallet_address")
  tokenMint       String   @map("token_mint")
  tokenSymbol     String?  @map("token_symbol")
  tradeType       String   @map("trade_type")
  solAmount       Float    @map("sol_amount")
  tokenAmount     Float    @map("token_amount")
  priceUsd        Float    @map("price_usd")
  volumeUsd       Float    @map("volume_usd")
  source          String   @default("manual")
  txSignature     String   @map("tx_signature")
  createdAt       DateTime @default(now()) @map("created_at")
  
  @@index([walletAddress])
  @@index([tokenMint])
  @@index([userId, tokenMint])
  @@index([createdAt])
  @@map("telegram_trades")
}

model TrackedToken {
  id              String   @id @default(cuid())
  telegramId      String   @map("telegram_id")
  tokenMint       String   @map("token_mint")
  tokenSymbol     String?  @map("token_symbol")
  alertPriceUp    Float?   @map("alert_price_up")
  alertPriceDown  Float?   @map("alert_price_down")
  createdAt       DateTime @default(now()) @map("created_at")
  
  @@unique([telegramId, tokenMint])
  @@map("tracked_tokens")
}